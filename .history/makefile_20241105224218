# Compiler and flags
CC = gcc
CFLAGS = -pthread -Wall

# Executable name
TARGET = echo_server

# Source files
SRC = echo_server.c

# Target to compile the echo server
$(TARGET): $(SRC)
	$(CC) $(CFLAGS) -o $(TARGET) $(SRC)

# Target to run tests and store output in test.txt
test: $(TARGET)
	(echo "Test 1: Starting server and connecting via Telnet"; echo; \
	echo "Command Run: ./$(TARGET) -p 50001"; echo; \
	./$(TARGET) -p 50001 &) \
		> test.txt 2>&1; \
	sleep 1; \
	(echo "Connecting with Telnet"; echo; \
	echo "Command Run: telnet localhost 50001"; echo; \
	(echo "Hello, Server!" | telnet localhost 50001) >> test.txt 2>&1; \
	sleep 1; \
	echo "Test complete. Check test.txt for results.") >> test.txt 2>&1; \
	killall $(TARGET)

# Target to clean up generated files
clean:
	rm -f $(TARGET) test.txt


